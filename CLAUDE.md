# pglayer

Secure PostgreSQL CLI for AI tools. Connect once, query forever - no credentials in commands.

## Project Structure

```
src/
├── index.ts          # CLI entry point
├── cli.ts            # Command definitions (connect, query, tables, etc.)
├── config/
│   ├── schema.ts     # Zod schemas for connections and config
│   └── store.ts      # Connection storage (~/.pglayer/connections.json)
├── db/
│   └── client.ts     # pg-promise client wrapper
├── query/
│   ├── index.ts      # QueryEngine class
│   └── types.ts      # Query result types
└── security/
    ├── read-only.ts  # Blocks write operations by default
    └── sanitizer.ts  # Redacts credentials from error messages
```

## Commands

```bash
npm run build    # Compile TypeScript
npm run dev      # Run with tsx (development)
npm start        # Run compiled version
```

## Key Design Decisions

- **Credentials stored locally**: `~/.pglayer/connections.json` with 600 permissions
- **Read-only by default**: Write operations require explicit `--allow-writes` flag
- **JSON output**: All commands return structured JSON for AI consumption
- **Error sanitization**: Connection strings and IPs are redacted from errors
- **Row limits**: Default 1000 rows max, auto-adds LIMIT to unbounded SELECTs

## Dependencies

- `commander` - CLI framework
- `pg-promise` - PostgreSQL client
- `zod` - Schema validation

## Testing

To test locally:
```bash
pglayer connect postgres://user:pass@localhost/testdb
pglayer query "SELECT 1"
pglayer tables
```


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>